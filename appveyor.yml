branches:
  only:
    - master

os: Visual Studio 2015

environment:
  matrix:
    - CMAKE_VS_VERSION: "10 2010"
      TEST_ALL: "no"
    - CMAKE_VS_VERSION: "14 2015"
      TEST_ALL: "no"

platform:
  - x86
  - x64

configuration:
  - Debug
  - Release

before_build:
  - cmake -G"Visual Studio %CMAKE_VS_VERSION%"
  # This cuts down on a lot of noise generated by xamarin warnings.
  - del "C:\Program Files (x86)\MSBuild\14.0\Microsoft.Common.targets\ImportAfter\Xamarin.Common.targets"

build:
  project: ALL_BUILD.vcxproj
  verbosity: minimal

test_script:
  - "cd tests"
  - rem "Building all code"
  - generate_code.bat -b %CONFIGURATION%
  - rem "---------------- C++ -----------------"
  - "cd .."
  - "%CONFIGURATION%\\flattests.exe"
  - "cd tests"
  - rem "---------------- Java -----------------"
  - "java -version"
  - "JavaTest.bat"
  - rem "---------------- JS -----------------"
  - "node --version"
  - "..\\%CONFIGURATION%\\flatc -b -I include_test monster_test.fbs unicode_test.json"
  - "node JavaScriptTest ./monster_test_generated"
  - rem "-------------- Python ---------------"
  - "python --version"
  - "pip --version"
  - rem "installing flatbuffers python library"
  - "pip install ../python"
  - "python py_test.py 0 0 0"
  - rem "---------------- C# -----------------"
  # Have to compile this here rather than in "build" above because AppVeyor only
  # supports building one project??
  - "cd FlatBuffers.Test"
  - "msbuild.exe /property:Configuration=Release;OutputPath=tempcs /verbosity:minimal FlatBuffers.Test.csproj"
  - "tempcs\\FlatBuffers.Test.exe"
  # TODO: add more languages.
  - "cd ..\\.."

artifacts:
  - path: $(CONFIGURATION)\flatc.exe
    name: flatc.exe
  - path: tests\MyGame\*
    name: MyGame
    type: zip
